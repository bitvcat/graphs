<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="873px" preserveAspectRatio="none" style="width:581px;height:873px;" version="1.1" viewBox="0 0 581 873" width="581px" zoomAndPan="magnify"><defs><filter height="300%" id="f1tqboe6rx4eqf" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><ellipse cx="350" cy="20" fill="#000000" filter="url(#f1tqboe6rx4eqf)" rx="10" ry="10" style="stroke: none; stroke-width: 1.0;"/><rect fill="#FF69B4" filter="url(#f1tqboe6rx4eqf)" height="33.9688" style="stroke: #A80036; stroke-width: 1.5;" width="128" x="286" y="50"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="291" x2="291" y1="50" y2="83.9688"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="409" x2="409" y1="50" y2="83.9688"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="108" x="296" y="71.1387">skynet_initthread</text><rect fill="#E0FFFF" filter="url(#f1tqboe6rx4eqf)" height="549.9531" style="stroke: #000000; stroke-width: 2.0;" width="498" x="45" y="147.9688"/><path d="M114,148.9688 L114,157.2656 L104,167.2656 L45,167.2656 " fill="none" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="59" x="48" y="161.9639">dispatch</text><rect fill="#FF69B4" filter="url(#f1tqboe6rx4eqf)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="154" x="273" y="184.2656"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="91" x="283" y="205.4043">尝试弹出一个mq</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="134" x="283" y="219.373">skynet_globalmq_pop</text><rect fill="#FF69B4" filter="url(#f1tqboe6rx4eqf)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="146" x="277" y="252.2031"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="126" x="287" y="273.3418">获取消息队列所属的ctx</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="125" x="287" y="287.3105">skynet_handle_grab</text><polygon fill="#FEFECE" filter="url(#f1tqboe6rx4eqf)" points="326,320.1406,374,320.1406,386,332.1406,374,344.1406,326,344.1406,314,332.1406,326,320.1406" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="48" x="326" y="335.9487">ctx!=null</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="294" y="329.5464">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="386" y="329.5464">no</text><rect fill="#FF69B4" filter="url(#f1tqboe6rx4eqf)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="128" x="174" y="354.1406"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="108" x="184" y="375.2793">派发指定数量的消息</text><rect fill="#FF69B4" filter="url(#f1tqboe6rx4eqf)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="162" x="157" y="422.0781"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="142" x="167" y="443.2168">再尝试弹出下一个nextmq</text><polygon fill="#FEFECE" filter="url(#f1tqboe6rx4eqf)" points="197,490.0156,279,490.0156,291,502.0156,279,514.0156,197,514.0156,185,502.0156,197,490.0156" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="82" x="197" y="505.8237">nextmq != null</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="20" x="165" y="499.4214">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="14" x="291" y="499.4214">no</text><rect fill="#FF69B4" filter="url(#f1tqboe6rx4eqf)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="199" x="57" y="524.0156"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="179" x="67" y="545.1543">把当前mq重新push回globalmq</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="140" x="67" y="559.123">skynet_globalmq_push</text><rect fill="#FF69B4" filter="url(#f1tqboe6rx4eqf)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="90" x="111.5" y="591.9531"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="70" x="121.5" y="613.0918">返回nextmq</text><rect fill="#FF69B4" filter="url(#f1tqboe6rx4eqf)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="87" x="276" y="524.0156"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="67" x="286" y="545.1543">返回当前mq</text><polygon fill="#FEFECE" filter="url(#f1tqboe6rx4eqf)" points="238,631.9219,250,643.9219,238,655.9219,226,643.9219,238,631.9219" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FF69B4" filter="url(#f1tqboe6rx4eqf)" height="47.9375" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="138" x="393" y="354.1406"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="84" x="403" y="375.2793">丢弃剩余的消息</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="118" x="403" y="389.248">skynet_mq_release</text><rect fill="#FF69B4" filter="url(#f1tqboe6rx4eqf)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="99" x="412.5" y="436.0469"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="79" x="422.5" y="457.1855">弹出下一个mq</text><polygon fill="#FEFECE" filter="url(#f1tqboe6rx4eqf)" points="350,661.9219,362,673.9219,350,685.9219,338,673.9219,350,661.9219" style="stroke: #A80036; stroke-width: 1.5;"/><rect fill="#FF69B4" filter="url(#f1tqboe6rx4eqf)" height="33.9688" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="316" y="761.9219"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="48" x="326" y="783.0605">睡眠线程</text><polygon fill="#FEFECE" filter="url(#f1tqboe6rx4eqf)" points="313,717.9219,387,717.9219,399,729.9219,387,741.9219,313,741.9219,301,729.9219,313,717.9219" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="74" x="313" y="733.73">globalmq为空</text><polygon fill="#FEFECE" filter="url(#f1tqboe6rx4eqf)" points="350,815.8906,362,827.8906,350,839.8906,338,827.8906,350,815.8906" style="stroke: #A80036; stroke-width: 1.5;"/><polygon fill="#FEFECE" filter="url(#f1tqboe6rx4eqf)" points="279,103.9688,421,103.9688,433,115.9688,421,127.9688,279,127.9688,267,115.9688,279,103.9688" style="stroke: #A80036; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="142" x="279" y="119.7769">是否退出（m-&gt;quit==0）?</text><ellipse cx="24" cy="158.9688" fill="#FFFFFF" filter="url(#f1tqboe6rx4eqf)" rx="11" ry="11" style="stroke: #000000; stroke-width: 1.0;"/><ellipse cx="24" cy="158.9688" fill="#000000" rx="6" ry="6" style="stroke: #7F7F7F; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="350" x2="350" y1="30" y2="50"/><polygon fill="#A80036" points="346,40,350,50,354,40,350,44" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="350" x2="350" y1="232.2031" y2="252.2031"/><polygon fill="#A80036" points="346,242.2031,350,252.2031,354,242.2031,350,246.2031" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="238" x2="238" y1="388.1094" y2="422.0781"/><polygon fill="#A80036" points="234,412.0781,238,422.0781,242,412.0781,238,416.0781" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="156.5" x2="156.5" y1="571.9531" y2="591.9531"/><polygon fill="#A80036" points="152.5,581.9531,156.5,591.9531,160.5,581.9531,156.5,585.9531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="185" x2="156.5" y1="502.0156" y2="502.0156"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="156.5" x2="156.5" y1="502.0156" y2="524.0156"/><polygon fill="#A80036" points="152.5,514.0156,156.5,524.0156,160.5,514.0156,156.5,518.0156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="291" x2="319.5" y1="502.0156" y2="502.0156"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="319.5" x2="319.5" y1="502.0156" y2="524.0156"/><polygon fill="#A80036" points="315.5,514.0156,319.5,524.0156,323.5,514.0156,319.5,518.0156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="156.5" x2="156.5" y1="625.9219" y2="643.9219"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="156.5" x2="226" y1="643.9219" y2="643.9219"/><polygon fill="#A80036" points="216,639.9219,226,643.9219,216,647.9219,220,643.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="319.5" x2="319.5" y1="557.9844" y2="643.9219"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="319.5" x2="250" y1="643.9219" y2="643.9219"/><polygon fill="#A80036" points="260,639.9219,250,643.9219,260,647.9219,256,643.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="238" x2="238" y1="456.0469" y2="490.0156"/><polygon fill="#A80036" points="234,480.0156,238,490.0156,242,480.0156,238,484.0156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="462" x2="462" y1="402.0781" y2="436.0469"/><polygon fill="#A80036" points="458,426.0469,462,436.0469,466,426.0469,462,430.0469" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="314" x2="238" y1="332.1406" y2="332.1406"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="238" x2="238" y1="332.1406" y2="354.1406"/><polygon fill="#A80036" points="234,344.1406,238,354.1406,242,344.1406,238,348.1406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="386" x2="462" y1="332.1406" y2="332.1406"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="462" x2="462" y1="332.1406" y2="354.1406"/><polygon fill="#A80036" points="458,344.1406,462,354.1406,466,344.1406,462,348.1406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="238" x2="238" y1="655.9219" y2="673.9219"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="238" x2="338" y1="673.9219" y2="673.9219"/><polygon fill="#A80036" points="328,669.9219,338,673.9219,328,677.9219,332,673.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="462" x2="462" y1="470.0156" y2="673.9219"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="462" x2="362" y1="673.9219" y2="673.9219"/><polygon fill="#A80036" points="372,669.9219,362,673.9219,372,677.9219,368,673.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="350" x2="350" y1="300.1406" y2="320.1406"/><polygon fill="#A80036" points="346,310.1406,350,320.1406,354,310.1406,350,314.1406" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="350" x2="350" y1="741.9219" y2="761.9219"/><polygon fill="#A80036" points="346,751.9219,350,761.9219,354,751.9219,350,755.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="399" x2="411" y1="729.9219" y2="729.9219"/><polygon fill="#A80036" points="407,768.9063,411,778.9063,415,768.9063,411,772.9063" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="411" x2="411" y1="729.9219" y2="827.8906"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="411" x2="362" y1="827.8906" y2="827.8906"/><polygon fill="#A80036" points="372,823.8906,362,827.8906,372,831.8906,368,827.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="350" x2="350" y1="795.8906" y2="815.8906"/><polygon fill="#A80036" points="346,805.8906,350,815.8906,354,805.8906,350,809.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="350" x2="350" y1="685.9219" y2="717.9219"/><polygon fill="#A80036" points="346,707.9219,350,717.9219,354,707.9219,350,711.9219" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="350" x2="350" y1="127.9688" y2="184.2656"/><polygon fill="#A80036" points="346,174.2656,350,184.2656,354,174.2656,350,178.2656" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="350" x2="350" y1="839.8906" y2="849.8906"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="350" x2="555" y1="849.8906" y2="849.8906"/><polygon fill="#A80036" points="551,498.8984,555,488.8984,559,498.8984,555,494.8984" style="stroke: #A80036; stroke-width: 1.5;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="555" x2="555" y1="115.9688" y2="849.8906"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="555" x2="433" y1="115.9688" y2="115.9688"/><polygon fill="#A80036" points="443,111.9688,433,115.9688,443,119.9688,439,115.9688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="267" x2="24" y1="115.9688" y2="115.9688"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="24" x2="24" y1="115.9688" y2="147.9688"/><polygon fill="#A80036" points="20,137.9688,24,147.9688,28,137.9688,24,141.9688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.5;" x1="350" x2="350" y1="83.9688" y2="103.9688"/><polygon fill="#A80036" points="346,93.9688,350,103.9688,354,93.9688,350,97.9688" style="stroke: #A80036; stroke-width: 1.0;"/><!--MD5=[f5ed56f5a9ea9fa7b619b2659d765444]
@startuml
start
:skynet_initthread|

while (是否退出（m->quit==0）?)
    partition dispatch #LightCyan {
        skinparam ActivityBackgroundColor #HotPink
        :尝试弹出一个mq
        //skynet_globalmq_pop//;

        :获取消息队列所属的ctx
        //skynet_handle_grab//;
        if (ctx!=null) then (yes)
            :派发指定数量的消息;
            :再尝试弹出下一个nextmq;
            if (nextmq != null) then (yes)
                :把当前mq重新push回globalmq
                //skynet_globalmq_push//;
                :返回nextmq;
            else (no)
                :返回当前mq;
            endif
        else (no)
            :丢弃剩余的消息
            //skynet_mq_release//;
            :弹出下一个mq;
        endif
    }

    if (globalmq为空) then
        :睡眠线程;
    endif
endwhile

stop
@enduml

PlantUML version 1.2020.10(Sun May 17 17:35:57 CST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.7+10-post-Ubuntu-2ubuntu218.04
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>